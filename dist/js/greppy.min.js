/** Greppy Frontend 0.6.1 */ var greppy={};greppy.Application=function(){};greppy.Application.prototype.dialog=function(body,options,buttons){var template='<div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">'+'<div class="modal-dialog"><div class="modal-content"><div class="modal-header">'+'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'+"{{header}}"+"</div>"+'<div class="modal-body">'+"</div>"+'<div class="modal-footer">'+"</div></div></div></div>";options=options||{};options.header=options.header||"Confirmation required";template=template.replace("{{header}}",'<h4 class="modal-title">'+options.header+"</h4>");var modal=$(template);modal.find(".modal-body").html(body);buttons=buttons||[{label:"Cancel","class":"btn btn-default",icon:"fa-times",callback:options.cancel||function(callback){callback()}},{label:"Ok","class":"btn btn-primary",icon:"fa-check",callback:options.ok||function(callback){callback()}}];buttons.forEach(function(btn){var btnObj=$('<a href="#" class="'+btn.class+'">'+'<i class="fa '+btn.icon+'"></i> '+btn.label+"</a>");btnObj.click(function(){btn.callback(function(){modal.modal("hide")});return false});modal.find(".modal-footer").append(btnObj)});$("body").append(modal);modal.modal({keyboard:true,show:true});modal.on("hidden.bs.modal",function(){modal.remove()});modal.on("shown.bs.modal",function(){modal.find("input:first").focus()})};greppy.Controller=function(options){var self=this;Object.keys(options).forEach(function(key){self[key]=options[key]})};greppy.Controller.prototype.link=function(action,params){if(!this.actions.hasOwnProperty(action)){throw new Error('Action "'+action+'" is not registered for the controller');return}var link=this.basePath+this.actions[action].path;if(params){Object.keys(params).forEach(function(param){link=link.replace(new RegExp(":"+param+"[?]?","ig"),params[param])})}return link};greppy.DataGrid=function(table,options){var s=new greppy.Styler;this.table=table;this.search=new greppy.Search(this,table);this.sort=new greppy.Sort(this,table);this.paginate=new greppy.Paginator(this,table);this.options=options||{};this.options.softDeletion="undefined"!==typeof options.softDeletion?options.softDeletion:true;this.options.url=options.url||document.URL;if(0<table.length){s.initOverlay(this.table,"gDatagridLoading","gDatagridRebuilt")}$(".btn").on({change:function(e){setTimeout(function(){$(e.currentTarget).trigger("gChange")},20)}})};greppy.DataGrid.prototype.buildUrl=function(params){var self=this;var url=this.options.url;params=params||[];if(this.options.softDeletion){if(true===$("#search-trash label").hasClass("active")){params.unshift({name:"filter",value:"trash"})}}if(-1===document.URL.indexOf("?")){url+="?"}params.forEach(function(param){if(param.value){url+="&"+param.name+"="+encodeURIComponent(param.value)}});return url};greppy.DataGrid.prototype.loadAndRebuild=function(params,callback){this.table.trigger("gDatagridLoading");var self=this;params=params||[];var load=function(url){$.ajax({type:"GET",url:url}).done(callback)};var url=this.buildUrl(params);if("function"===typeof this.options.preLoad){this.options.preLoad(url,function(err,url){if(err){return}load(url)})}else{load(url)}};greppy.DataGrid.prototype.reset=function(){var self=this;var reset=function(){self.load(true,true,1)};if("function"===typeof this.options.preReset){this.options.preReset(function(err){if(err){return}reset()})}else{reset()}};greppy.DataGrid.prototype.load=function(rows,pagination,page){var self=this;var params=[];if("undefined"===typeof rows){rows=true}if("undefined"===typeof pagination){pagination=true}params=params.concat(this.search.getParameters());params=params.concat(this.sort.getParameters());params=params.concat(this.paginate.getParameters(page));if(true===rows){var rowParams=[].concat(params);rowParams.unshift({name:"render",value:"rows"});this.loadAndRebuild(rowParams,function(data){self.table.find("tr").not(":first").remove();self.table.find("tbody").append(data);self.table.trigger("gDatagridRebuilt")})}if(true===pagination){var paginationParams=[].concat(params);paginationParams.unshift({name:"render",value:"pagination"});this.loadAndRebuild(paginationParams,function(data){$(".paginator").html(data)})}};greppy.Paginator=function(datagrid,datagridElement){var self=this;var doc=$(document);this.datagrid=datagrid;this.datagridElement=datagridElement;this.page=1;doc.on("click",".pagination a[data-page]",function(){var page=$(this).attr("data-page");if(self.page==page){return}self.page=$(this).attr("data-page");self.datagrid.load()});doc.on("change","#pagination-limit",function(){self.datagrid.reset()});doc.on("keydown",function(e){if($("input, textarea").is(":focus")){return}if(37==e.keyCode){self.page=self.page>0?self.page-1:1;self.datagrid.load()}if(39==e.keyCode){var maxPage=1;$(".pagination a[data-page]").each(function(idx,itm){var val=parseInt($(itm).attr("data-page"));maxPage=maxPage<val?val:maxPage});self.page=self.page<maxPage?self.page+1:self.page;self.datagrid.load()}if(71==e.keyCode){greppy.app.dialog(['<div class="col-lg-5">','<input autofocus="autofocus" class="form-control" id="page-to-jump" ',' name="page-to-jump" type="number" placeholder="Page to jump to ..">',"</div><br />"].join(""),{header:"Quick page jump",ok:function(callback){self.page=parseInt($("#page-to-jump").val());self.datagrid.load();callback&&callback()}})}})};greppy.Paginator.prototype.getParameters=function(page){return[{name:"page",value:page||this.page},{name:"limit",value:$("#pagination-limit :selected").val()}]};greppy.Search=function(datagrid,datagridElement){var self=this;this.datagrid=datagrid;this.datagridElement=datagridElement;this.input=$("#search-input");this.trash=$("#search-trash");this.datagridElement.find($("th[data-property]")).each(function(idx,itm){var th=$(itm);th.html($("<span>&nbsp;"+th.text()+"&nbsp;</span>"));th.prepend($('<i class="search-trigger fa fa-search text-muted"></i>'))});$("#search-trash").on("gChange",function(e){self.datagrid.paginate.page=1;self.datagrid.load()});$("#search-btn").on("click",function(){self.datagrid.paginate.page=1;self.datagrid.load()});$(".search-trigger").on("click",function(){var cur=$(this).parent();self.settings(cur.attr("data-property"),cur.text());$("#search-input").focus()});$("#search-clear").on("click",function(){self.clear();self.settings("fuzzy");self.datagrid.reset()});$("#search-input").keypress(function(event){if(event.keyCode==13){$("#search-btn").trigger("click")}})};greppy.Search.prototype.settings=function(property,placeholder){if("fuzzy"==property){placeholder="Fuzzy search"}else{placeholder="Search for"+placeholder.toLowerCase()}this.input.attr("placeholder",placeholder+"..").attr("data-property",property)};greppy.Search.prototype.clear=function(){this.input.val("")};greppy.Search.prototype.getParameters=function(){var params=[];if(""==this.input.val()){return params}var params=params.concat([{name:"search",value:this.input.val()},{name:"sprop",value:this.input.attr("data-property")}]);return params};greppy.Sort=function(datagrid,datagridElement){var self=this;this.datagrid=datagrid;this.datagridElement=datagridElement;this.datagridElement.find($("th[data-property] span")).on("click",function(){self.toggle($(this).parent())})};greppy.Sort.prototype.toggle=function(th){this.datagridElement.find($("th[data-property]")).not(th).each(function(idx,item){item=$(item);item.find(".direction").remove();item.attr("data-sort","")});var dir=th.attr("data-sort");if(!dir){th.append($('<i class="direction text-muted fa fa-arrow-down"></i>'));th.attr("data-sort","asc")}if("asc"===dir){th.find(".direction").removeClass("fa-arrow-down").addClass("fa-arrow-up");th.attr("data-sort","desc")}if("desc"===dir){th.find(".direction").remove();th.attr("data-sort","")}if(!th.attr("data-sort")){return this.datagrid.reset()}this.datagrid.load()};greppy.Sort.prototype.getParameters=function(){var th=this.datagridElement.find($("th[data-property]")).not($('[data-sort=""]'));if(0===th.length||!th.attr("data-sort")||""==th.attr("data-sort")){return[]}return[{name:"order",value:th.attr("data-sort")},{name:"oprop",value:th.attr("data-property")}]};greppy.Styler=function(){};greppy.Styler.prototype.styleUpload=function(el){function showFilename(){$(newUploadSel+" .file-path").text(el.val().split("\\").pop())}el=this.validateStyleUpload(el);var newUploadSel='div[data-fileuploadname="'+el.attr("name")+'"]';var markup='<div class="input-group" data-fileuploadname="'+el.attr("name")+'"'+' data-greppy-validator-mark="'+el.attr("name")+'">'+'<span class="input-group-addon"><i class="fa fa-file"></i></span>'+'<div class="form-control"><span class="file-path"></span></div>'+'<span class="input-group-btn">'+'<button class="btn btn-default">Datei w√§hlen</button>'+"</span>"+"</div>";el.after(markup);if(el.val()){showFilename()}el.on("change",function(){showFilename()});$(newUploadSel+" button, "+newUploadSel+" .form-control").on("click",function(){el.trigger("click");return false});el.hide()};greppy.Styler.prototype.validateStyleUpload=function(el){var name;el=$(el);if(1!==el.length){throw new Error("Expected single element to style, but got "+el.length)}name=el.attr("name");if(!name||$('*[name="'+name+'"]').length>1){throw new Error("Element needs to have a unique name")}return el};greppy.Styler.prototype.styleNumber=function(el){el=this.validateStyleNumber(el);el.each(function(idx,el){el=$(el);el.wrap('<div class="input-group greppy-container-num" '+'data-greppy-validator-mark="'+el.attr("name")+'"></div>');el.addClass("pull-left");el.after('<div class="input-group-btn pull-left">'+'<button class="btn btn-default g-add" type="button">'+'<i class="fa fa-plus"></i>'+"</button>&nbsp;"+'<button class="btn btn-default g-substract" type="button">'+'<i class="fa fa-minus"></i>'+"</button>"+"</div>");el.next(".input-group-btn").find(".g-add").on("click",function(){var val=isNaN(parseInt(el.val(),10))?0:parseInt(el.val(),10);val=el.attr("data-max")<val+1?val:val+1;el.val(val);el.trigger("change")});el.next(".input-group-btn").find(".g-substract").on("click",function(){var val=isNaN(parseInt(el.val(),10))?0:parseInt(el.val(),10);val=el.attr("data-min")>val-1?val:val-1;el.val(val);el.trigger("change")})})};greppy.Styler.prototype.validateStyleNumber=function(el){el=$(el);el.each(function(idx,el){if("INPUT"!==$(el).prop("tagName")){throw new Error("Element needs to be an input")}});return el};greppy.Styler.prototype.initOverlay=function(el,showEvent,removeEvent){var self=this;var overlayId="gOverlay"+(new Date).getTime();var evts={};el=$(el);if(1!==el.length){throw new Error("Expected single element for overlay, but got "+el.length)}evts[showEvent]=function(){el.parent().find("#"+overlayId).remove();el.after('<div class="greppy-overlay" id="'+overlayId+'" />');$("#"+overlayId).css({background:"rgba(255, 255, 255, 0.6)",position:"absolute",top:el.position().top,left:el.position().left,width:el.outerWidth(),height:el.outerHeight()});self.initSpinner(document.getElementById(overlayId))};evts[removeEvent]=function(){$("#"+overlayId).remove()};el.on(evts)};greppy.Styler.prototype.initSpinner=function(target,opts){opts=opts||{lines:11,length:0,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:29,shadow:false,hwaccel:true,className:"spinner",zIndex:2e9};this.spinner=new Spinner(opts).spin(target)};greppy.Validator=function(){};greppy.Validator.prototype.init=function(){var self=this;this.allValidators=$("input, select, textarea").filter(".greppy-validator");this.uniqueValidators=this.getUniqueValidators(this.allValidators);this.bindEvent("invalid","gValidationInvalid");this.bindEvent("change","gValidationUpdate");this.bindEvent("keyup","gValidationUpdate");$(document).on({gValidationUpdate:function(e){self.validate(e.target)},gValidationInvalid:function(e){if(self.isUniqueValidator(e.target)){self.markInvalid(self.getMark(e.target));self.showMsg(e.target)}e.preventDefault()}})};greppy.Validator.prototype.bindEvent=function(origEvtName,gEvtName){if("gValidationInvalid"!==gEvtName&&"gValidationUpdate"!==gEvtName){throw new Error("No such Greppy validator event exists: "+gEvtName)}this.allValidators.on(origEvtName,function(e){$(this).trigger(gEvtName);if("gValidationInvalid"===gEvtName){e.preventDefault()}})};greppy.Validator.prototype.isUniqueValidator=function(el){return this.getUniqueValidator(el).is(el)};greppy.Validator.prototype.getUniqueValidator=function(el){return this.uniqueValidators.filter('[name="'+$(el).attr("name")+'"]')};greppy.Validator.prototype.getUniqueValidators=function(allValidators){var uniques=$();allValidators.each(function(idx,el){el=$(el);if(el.attr("name")&&uniques.filter('[name="'+$(el).attr("name")+'"]').length){return}uniques=uniques.add(el)});return uniques};greppy.Validator.prototype.getMark=function(el){el=$(el);var name=el.attr("name");var result;if(null===name){return el}result=$('*[data-greppy-validator-mark="'+name+'"]');if(0===result.length&&el.hasClass("multiselect")){result=el.nextAll(".btn-group")}return 0<result.length?result:el};greppy.Validator.prototype.validate=function(el){if(false===el.checkValidity()){this.markInvalid(this.getMark(el));this.showMsg(el);return}this.removeInvalidMark(this.getMark(el));this.removeMsg(this.getMark(el))};greppy.Validator.prototype.markInvalid=function(el){$(el).addClass("greppy-validator-invalid")};greppy.Validator.prototype.removeInvalidMark=function(el){$(el).removeClass("greppy-validator-invalid")};greppy.Validator.prototype.showMsg=function(el){el=this.getUniqueValidator(el);var mark=this.getMark(el);var self=this;if(this.hasActiveMsg(el)){return}$('<div class="greppy-validator-msg btn btn-danger" data-greppy-validator-name="'+el.attr("name")+'" />').html(el.attr("data-greppy-validator-msg")||"Validation failed").insertAfter(mark).hide().fadeIn().css({top:mark.position().top+mark.outerHeight()+4,left:mark.position().left}).on("mouseleave",function(){self.removeMsg(mark)})};greppy.Validator.prototype.hasActiveMsg=function(el){var name=el.attr("name");if(name&&$('.greppy-validator-msg[data-greppy-validator-name="'+name+'"]').length){return true}return false};greppy.Validator.prototype.removeMsg=function(el,fast){el=$(el).nextAll(".greppy-validator-msg");if(fast){el.remove();return}el.fadeOut(function(){el.remove()})};greppy.app=new greppy.Application;